<table class="repository_meta">
  <tr class="name">
    <td colspan="3" class="<%= repository.mainline? ? "mainline" : "clone" -%>">
      <h2 style="display: inline;"><%= link_to h(repository.name), [@owner, repository] -%></h2>
      <ul class="horizontal" style="position: relative; top: -2px; padding-left: 10px">
        <li class="commit"><%= link_to "Commit log", [@owner, repository, :commits] -%></li>
        <li class="tree"><%= link_to "Source tree", [@owner, repository, :trees] -%></li>
        <li class="merge_requests">
          <%= link_to "Merge requests <small>(#{repository.merge_requests.count})</small>", [@owner, repository, :merge_requests] -%>
        </li>
        <% if repository.parent -%>
        <li class="clone">
          <%= link_to "Clone of #{h(repository.parent.name)}", [repository.parent.owner, repository.parent] -%>
        </li>
        <% end -%>
      </ul>
    </td>
  </tr>
  <tr>
    <td colspan="3" class="repository-description">
      <div class="page">
        <%= paragraphs_with_more auto_link(markdown(sanitize(repository.description)), :urls) -%>
      </div>
    </td>
  </tr>
  <tr class="meta">
    <td class="commit_count">
      <span class="bignum"><%= repository.events.count -%></span> <%= t("views.repos.activities", :count => repository.events.count) %>
    </td>
    <td class="branch_count">
	<% @branch_count = repository.ready? ? repository.git.heads.size : 0 -%>
      <span class="bignum"><%= @branch_count -%></span> <%= t("views.repos.branches", :count => @branch_count) %>
    </td>
    <td class="author_count">
	<% @author_count = repository.ready? ? repository.commit_graph_data_by_author.keys.size : 0 -%>
      <span class="bignum"><%= @author_count -%></span> <%= t("views.repos.authors", :count => @author_count) %>
    </td>
  </tr>
  <tr class="graph">
    <td colspan="3"><%= commit_graph_tag(repository) %></td>
  </tr>
  <% # TODO: Clone stats -%>
  <% # TODO: divergence from mainline in +/- -%>
  <tr>
    <td colspan="3" class="infobox">
      <ul>
        <li>
          <strong><%= t("views.repos.public_url") %>:</strong> 
          <a href="<%= repository.clone_url-%>" class="link_noop"><code><%=h repository.clone_url -%></code></a> 
          <small><%= link_to_help_toggle('detailed_clone_info') -%></small>
          <div id="detailed_clone_info" class="info_hint" style="display:none">
            <%= t("views.repos.help_clone") %>:<br />
            <code>git clone <%= repository.clone_url -%></code>
          </div>
        </li>
        <li>
          <strong><%= t("views.repos.http_url") %>:</strong> 
          <a href="<%= repository.http_clone_url-%>" class="link_noop"><code><%=h repository.http_clone_url -%></code></a> 
          <small><%= link_to_help_toggle('detailed_http_clone_info') -%></small>
          <div id="detailed_http_clone_info" class="info_hint" style="display:none">
            <%= t("views.repos.help_clone") %>:<br />
              <code>git clone <%= repository.http_clone_url -%></code><br />
              <small>(<%= t("views.repos.help_clone_http") %>)</small>
          </div>
        </li>
        <% if logged_in? && current_user.can_write_to?(repository) -%>
          <li>
            <strong><%= t("views.repos.push_url") %>:</strong> <code><%=h repository.push_url -%></code>
            <small><%= link_to_help_toggle('detailed_push_info') -%></small>
            <div id="detailed_push_info" class="info_hint" style="display:none">
      		<%= t("views.repos.help_push").call(repository.push_url) %>
      <pre>
      git remote add origin <%= repository.push_url %>
      # to push the master branch to the origin remote we added above:
      git push origin master 
      # after that you can just do:
      git push
      </pre>
            </div>
          </li>
        <% end -%>
      </ul>
      <div class="meta-info">
        <ul class="horizontal">
          <%= download_archive_links(repository) if repository.has_commits? -%>
        </ul>
      </div>
    </td>
  </tr>
</table>